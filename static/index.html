<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>College Counselor Chat</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; margin: 0; padding: 0; }
    #chat-container { max-width: 700px; margin: 30px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    #messages { height: 500px; overflow-y: auto; padding: 15px; border-bottom: 1px solid #ddd; }
    .msg { margin-bottom: 12px; }
    .user { color: #333; font-weight: bold; }
    .bot { color: #0056b3; }
    #input-area { display: flex; padding: 15px; }
    #input-area input { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
    #input-area button { margin-left: 8px; padding: 10px 15px; background: #0056b3; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
    #input-area button:hover { background: #003d80; }

    .recommendations { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 10px; }
    .card {
      background: #f1f1f1;
      border-radius: 8px;
      padding: 15px;
      flex: 1 1 calc(50% - 12px);
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .card strong { display: block; margin-bottom: 5px; color: #0056b3; font-size: 1.1em; }
    .card a { color: #0056b3; text-decoration: none; font-weight: bold; }
    .card a:hover { text-decoration: underline; }
    .card div { margin-bottom: 4px; font-size: 0.95em; color: #333; }
    .card ul { margin: 0; padding-left: 18px; font-size: 0.9em; color: #555; }
    .card ul li { margin-bottom: 2px; }
  </style>
</head>
<body>
  <div id="chat-container">
    <div id="messages"></div>
    <div id="input-area">
      <input id="user-input" type="text" placeholder="Type your message..." />
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>

<script>
  const chatId = 'user_' + Math.floor(Math.random() * 1e8);
  const apiUrl = 'http://localhost:8000/'; // Update if backend is elsewhere

  const messagesDiv = document.getElementById('messages');
  const inputBox = document.getElementById('user-input');

  function appendMessage(sender, text, recommendations=[]) {
    const div = document.createElement('div');
    div.classList.add('msg');
    div.innerHTML = `<span class="${sender}">${sender === 'user' ? 'You' : 'Counselor'}:</span> ${text}`;

    if (recommendations.length > 0) {
      const recDiv = document.createElement('div');
      recDiv.className = 'recommendations';
      recDiv.innerHTML = recommendations.map(r => 
        `<div class="card">
          <strong>${r.name}</strong>
          <div><strong>Location:</strong> ${r.location}</div>
          <div><strong>Type:</strong> ${r.type}</div>
          <div><strong>Courses:</strong> ${r.courses}</div>
          <div><strong>Fees:</strong> ${r.fees}</div>
          <div><strong>Admission:</strong> ${r.admission_process}</div>
          ${r.match_reasons && r.match_reasons.length ? `<div><strong>Match Reasons:</strong><ul>${r.match_reasons.map(m => `<li>${m}</li>`).join('')}</ul></div>` : ''}
          <div><a href="${r.website}" target="_blank">Visit Website</a></div>
        </div>`
      ).join('');
      div.appendChild(recDiv);
    }

    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  async function sendMessage() {
    const text = inputBox.value.trim();
    if (!text) return;
    appendMessage('user', text);
    inputBox.value = '';

    try {
      const res = await fetch(apiUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ chat_id: chatId, message: text, action: 'chat' })
      });
      const data = await res.json();
      if (data.success) {
        appendMessage('bot', data.message, data.recommendations || []);
      } else {
        appendMessage('bot', 'Error: ' + (data.error || data.message));
      }
    } catch (err) {
      appendMessage('bot', 'Network error: ' + err.message);
    }
  }

  inputBox.addEventListener('keydown', e => {
    if (e.key === 'Enter') sendMessage();
  });
</script>
</body>
</html>
